YUI.add("mediaCenter-youtubeVideo-plugin",function(b){b.MediaCenterYoutubeVideo=b.Base.create("mediaCenter-youtubeVideo-plugin",b.Plugin.Base,[],{initializer:function(){this._host=this.get("host"),this._host.contentHandlers&&(this._host.contentHandlers.youtube=this),this.uniqueId=1},destructor:function(){},isMyType:function(e){var t=Boolean(e.ytId);return t&&(e.id=e.ytId),t},getDomElementPreShow:function(n,e,t){var o,i,a,s,r=this,l="ytube"+r.uniqueId++,u=b.Node.create("<div class='nclb-ytube-container' style='display:none;position:absolute;'><div id='"+l+"'></div></div>"),d="",c="";function p(e,t,o){jQuery&&jQuery().ncsEventTracker&&jQuery(document).ncsCustomEventTracker({cCategory:e,cAction:t,cLabel:o})}function h(e){var t,o;e?(u.one("iframe").setStyle("visibility",""),u.one(".jp-play").setStyle("display","none"),u.one(".jp-pause").setStyle("display","block"),u.setData("play",!0)):(u.one(".jp-play").setStyle("display","block"),u.one(".jp-pause").setStyle("display","none"),e=s.getCurrentTime(),o=s.getDuration(),t=Math.floor(e/o*100),0<e&&0<o&&(o=e="",0<t&&t<26?e="0-25%":25<t&&t<51?e="26-50%":50<t&&t<76?e="51-75%":75<t&&t<91?e="76-90%":90<t&&t<101&&(e="91-100%"),p("Video","Pause",(o=void 0!==n.item.info.title?n.item.info.title.replace(/"/g,'"'):o)+" - "+e)),u.setData("play",!1))}function y(e){return s.pauseVideo(),h(!1),e&&e.preventDefault(),!1}function m(e){return s.playVideo(),h(!0),e&&e.preventDefault(),!1}function f(e){e=100*e/u.one(".jp-seek-bar").get("offsetWidth"),e=s.getDuration()*(e/100);s.seekTo(e,!0)}function g(){var e=s.getCurrentTime(),t=s.getDuration();0<t&&(e=100*e/t,u.one(".jp-play-bar").setStyle("width",e+"%")),r.timer=setTimeout(g,100)}function v(){var e=s.getVolume();u.one(".jp-volume-bar-value").setStyle("width",e+"%")}p("Video","Launch",(d=void 0!==n.item.info.title?n.item.info.title.replace(/"/g,'"'):d)+" - "+(c=void 0!==n.item.id?n.item.id:c)),u.appendChild(b.one("#vtemplate-controls").get("innerHTML")),e.append(u),o=u.one(".jp-volume-bar"),i=u.one(".noscrubber").removeClass("noscrubber").addClass("scrubber"),(a=new b.DD.Drag({node:i,initConstraints:function(){var e=u.one(".jp-seek-bar"),t=b.DOM.region(e),o=b.DOM.getXY(e),n=parseInt(b.DOM.getStyle(e,"width"),10),e=parseInt(b.DOM.getStyle(e,"height"),10),n={top:o[1]-t.top,right:t.right-o[0]-n,bottom:t.bottom-o[1]-e,left:o[0]-t.left};a.setXConstraint(n.left,n.right),a.setYConstraint(n.top,n.bottom)}})).on("drag:start",function(){var e=u.getData("play");u.setData("indrag",!0),u.setData("wasPaused",!0!==e),e&&y()}),a.on("drag:drag",function(){f(i.getX()-u.one(".jp-seek-bar").getX())}),a.on("drag:end",function(){setTimeout(function(){f(i.getX()-u.one(".jp-seek-bar").getX()),i.removeAttribute("style"),u.setData("indrag",!1)},10),!1===u.getData("wasPaused")&&m()}),u.one(".jp-seek-bar").on("click",function(e){var e=e.clientX-u.one(".jp-seek-bar").getX(),t=u.one(".jp-seek-bar").get("offsetWidth");e&&(e=100*e/t,t=s.getDuration()*(e/100),s.seekTo(t,!0))}),o.on("click",function(e){var t=o.get("region"),e=e.clientX-t.left,e=Math.floor(100*e/t.width);s.setVolume(e),setTimeout(v,100)}),s=r.ytube=new YT.Player(l,{width:r._host.get("video.width"),height:r._host.get("video.height"),videoId:n.item.ytId,playerVars:{controls:0,showinfo:0,autoplay:0},events:{onReady:function(){u.one(".video-controls").setStyle("display","block"),g(),v()},onStateChange:function(e){e.data===YT.PlayerState.ENDED?(u.one("iframe").setStyle("visibility","hidden"),h(!1)):e.data===YT.PlayerState.PLAYING&&(h(!0),u.one("iframe").setStyle("visibility","visible"))}}}),c=(d=u.one("iframe")).get("src"),d.setAttribute("id","ytPlayer"),c=c.replace(/\?controls/,"?wmode=opaque&controls"),d.set("src",c),u.one(".jp-play").on("click",m),u.one(".jp-pause").on("click",y),u.one(".jp-full-screen").on("click",function(e){function t(){u.removeClass("jp-video-full"),u.one(".jp-full-screen").removeClass("jp-small-screen"),b.Node(document.documentElement).detach("keydown",o),r._host.ignoreEsc=!1}function o(e){27===e.which&&t()}e.preventDefault(),u.hasClass("jp-video-full")?t():(u.addClass("jp-video-full"),u.one(".jp-full-screen").addClass("jp-small-screen"),b.Node(document.documentElement).on("keydown",o),r._host.ignoreEsc=!0)}),t(u)},showHideOverlays:function(e){!0===this.get("showHideControls")&&(e=e?"visible":"hidden",this._host._getMainContentArea().one(".video-controls").setStyle("visibility",e))},setupDomElementAfterShow:function(t,o){var n=this;if(!o)try{this.ytube.playVideo()}catch(e){setTimeout(function(){n.setupDomElementAfterShow(t,o)},25)}},handleDomElementPostShow:function(e,t){this.timer&&clearTimeout(this.timer),this.timer=null,t.remove(!0)}},{NS:"content_youtube",ATTRS:{templateUrl:{value:"/tmpl/videoTemplate.htm"},showHideControls:{value:!0}}})},"@VERSION@",{requires:["mediaCenter-base","base-build","plugin","io-base","dd","event-hover","node-screen"]});