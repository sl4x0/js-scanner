YUI.add("element-coins",(function(e){"use strict";var o=window.native,t=e.namespace("Util").optional,i=window.tp_strings.coins.tooltip;function n(e,t){if(!t.relatedTarget||!(t.relatedTarget===t.currentTarget||t.currentTarget.compareDocumentPosition(t.relatedTarget)&Node.DOCUMENT_POSITION_CONTAINED_BY)){if(e&&"mouseover"===t.type)return o.call("ShowTextTooltip",e);o.call("HideTextTooltip"),o.call("HideItemTooltip")}}e.namespace("Elements").coins=function(l,a){var s=a||{},r=parseInt(l,10)||0,c=Math.floor(r/1e4),d=Math.floor(r%1e4/100),u=r%100,g=String(c).length,p=g>3?c.toLocaleString(o.stats.language):c,T=s.hide,h=s.class||s.className||"";return m(".coins",e.merge(s,{hide:null,"data-digits":t(g>3,"4+",g),class:[h,t(s.align,"align"),t(!r,"empty")].join(" "),onmouseover:t(T&&g>3,n.bind(null,e.Lang.sub(i,{gold:p,silver:d,copper:u}))),onmouseout:t(T&&g>3,n.bind(null,null))}),m(".gold.coin",{class:t(T&&!c,"hide")},p),m(".silver.coin",{class:t(T&&(!d&&!c||g>4),"hide")},d),m(".copper.coin",{class:t(T&&g>3,"hide")},u))}}),"@VERSION@",{requires:["util-optional","css-coins"]});
YUI.add("model-coins",(function(t){"use strict";var e,n=t.namespace("GW2.Models");e=t.Base.create("coins",t.Model,[],{initializer:function(){this.on("amountChange",t.bind(this._onAmountChange,this)),this._eventHandles=[this.after({maxAmountChange:this._onMaxAmountChange})],this.publish("coins:amountTooHigh")},destructor:function(){new t.EventHandle(this._eventHandles).detach(),this._eventHandles=[]},_onAmountChange:function(t){var e=t.newVal;this.setAttrs({gold:this._gold(e),silver:this._silver(e),copper:this._copper(e)},{silent:!0})},addGold:function(t){this.set("amount",this.get("amount")+100*t*100)},addSilver:function(t){this.set("amount",this.get("amount")+100*t)},addCopper:function(t){this.set("amount",this.get("amount")+t)},_gold:function(t){return Math.floor(t/1e4)},_silver:function(t){return Math.floor(t%1e4/100)},_copper:function(t){return Math.floor(t%100)},_onMaxAmountChange:function(t){isFinite(t.newVal)&&this.get("amount")>t.newVal&&this.set("amount",t.newVal)},toString:function(){return"Coins{amount="+this.get("amount")+", gold="+this.gold()+", silver="+this.silver()+", copper="+this.copper()+"}"}},{ATTRS:{amountTooLow:{value:!1},amount:{value:0,setter:function(t){var e=this.get("minAmount"),n=this.get("maxAmount");return(t=parseInt(t,10)||0)<0&&(t=0),isFinite(e)&&t<e?this.set("amountTooLow",!0):this.set("amountTooLow",!1),isFinite(n)&&t>n&&(this.fire("amountTooHigh"),t=n),t}},minAmount:{value:void 0,setter:function(t){isFinite(t)&&this.set("amount",t,{silent:!0})}},maxAmount:{value:void 0,setter:function(t){isFinite(t)&&t<this.get("amount")&&this.set("amount",t,{silent:!0})}},gold:{value:0,getter:function(){return this._gold(this.get("amount"))},setter:function(e,n,i){if(!i||!i.silent){var o=e-this.get("gold");return this.addGold(o),t.Attribute.INVALID_VALUE}}},silver:{value:0,getter:function(){return this._silver(this.get("amount"))},setter:function(e,n,i){if(!i||!i.silent){var o=e-this.get("silver");return this.addSilver(o),t.Attribute.INVALID_VALUE}}},copper:{value:0,getter:function(){return this._copper(this.get("amount"))},setter:function(e,n,i){if(!i||!i.silent){var o=e-this.get("copper");return this.addCopper(o),t.Attribute.INVALID_VALUE}}}}}),n.Coins=e}),"@VERSION@",{requires:["base-build","model"]});
YUI.add("model-listings",(function(t){"use strict";var n=t.namespace("GW2.Models"),i=t.namespace("STS");n.Listings=t.Base.create("orderstate",t.Model,[],{sync:function(t,n,e){return this.setAttrs(n),this.set("loading",!0),i.request({protocol:"Game.gw2.Trade",command:"GetListings",headers:{t:"$"+this.get("dataId")},body:{buys:"",sells:"",count:40}}).then((function(n){n.action=t,e(null,n)}),(function(t){1050===t.code&&this.setAttrs({buys:[],sells:[]}),i.netError(t)}))},parse:function(t){return this.set("loading",!1),t.buys.map(this._normalizeListing),t.sells.map(this._normalizeListing),t},count:function(t){return this.get(t).reduce((function(t,n){return t+n.maxQuantity}),0)},_resetListing:function(t){return t.quantity=0,t},_noCustoms:function(t){return!t.isCustom},resetSelection:function(){var t=this.get("sells"),n=this.get("buys");this.setAttrs({sells:t?t.map(this._resetListing).filter(this._noCustoms):[],buys:n?n.map(this._resetListing).filter(this._noCustoms):[]})},_normalizeListing:function(t){return t.numListings=parseInt(t.listings,10)||0,t.maxQuantity=parseInt(t.quantity,10)||0,t.unitPrice=parseInt(t.unit_price,10)||1,delete t.listings,delete t.unit_price,t.quantity=0,t.attn="",t.isCustom=!1,t.isAffordable=!1,t},matchMake:function(t,n,i){var e=this.get(t);e.some((function(t){if(t.unitPrice===n)return t.quantity=i,!0}))||(e.push({isCustom:!0,quantity:i,unitPrice:n,numListings:0,maxQuantity:0}),e.sort((function(n,i){return"sells"===t?n.unitPrice-i.unitPrice:i.unitPrice-n.unitPrice})))},getListings:function(){return this.get("sells").concat(this.get("buys")).filter((function(t){return t.quantity>0}))},getQuantity:function(t,n){return this.get(t).filter((function(i){return"sells"===t?i.unitPrice<n:i.unitPrice>n})).reduce((function(t,n){return t+n.maxQuantity}),0)},hasQuantity:function(t){return this.get(t).some((function(t){return t.quantity>0}))}},{ATTRS:{price:{getter:function(){var t=this;return["buys","sells"].reduce((function(n,i){return n+t.get(i).reduce((function(t,n){return t+n.quantity*n.unitPrice}),0)}),0)}},loading:{value:!0}}})}),"@VERSION@",{requires:["base-build","model","sts-request"]});
YUI.add("extension-last-viewed",(function(e){"use strict";var t,a,i,n=e.namespace("GW2.Extensions"),r=e.namespace("GW2.Util").keys,s=window.native;try{t=JSON.parse(localStorage.lastViewed)}catch(e){t=[]}i=e.Promise((function(a){if(!t.length)return a(t);t.forEach((function(e){r.register(e.data_id,e.keys),r.inject(e.data_id)})),s.call("QueryItemInfo",{items:t.map((function(e){return parseInt(e.data_id,10)}))}).then((function(i){t=t.map((function(t){return e.merge(t,i[t.data_id])})),a(t)}))})),(a=function(){}).getRecent=function(){return i},a.prototype={initializer:function(){this._handle=this.after("itemChange",this._lastViewedAfterItemChange)},destructor:function(){this._handle.detach(),this._handle=null},_lastViewedAfterItemChange:function(a){var i=a.newVal,n=i.data_id||i.dataId,s=e.merge(i,{data_id:n,keys:r.keys[n]}),d=-1;t.forEach((function(e,t){d=e.data_id===n?t:d})),-1===d?(t.push(s),t.length>3&&t.shift()):(t.splice(d,1),t.push(s)),localStorage.lastViewed=JSON.stringify(t)}},n.LastViewed=a}),"@VERSION@",{requires:["array-extras","promise","util-text-keys"]});
YUI.add("model-orderstate",(function(t){"use strict";var e,s=t.namespace("GW2.Models"),i=t.namespace("GW2.Enums"),n=t.namespace("Elements"),a=t.namespace("STS"),r=t.namespace("GW2.Util"),o=t.namespace("GW2.Account"),u=r.log,h=r.keys,c=r.items,g=window.native,l={1023:"transactions.error.generic",1041:"transactions.error.cost",1049:"transactions.error.alreadysold",1050:"transactions.error.generic",1055:"transactions.error.generic",1056:"transactions.error.toomanylistings"};function d(t,e){var s,i=document.createElement("span");return m.render(i,n.coins(t,{hide:e})),s=i.innerHTML,i=null,s}e={itemCountByDataId:function(t){return g.stats.inventory.reduce((function(e,s){return s.dataId===t?e+s.count:e}),0)},itemByDataId:function(t){var e;return g.stats.inventory.some((function(s){if(s.dataId===t)return e=s,!0})),e}},s.OrderState=t.Base.create("orderstate",t.Model,[t.namespace("GW2.Extensions").LastViewed],{lastListing:!1,initializer:function(){this.maxUnitPrice=new s.Coins({maxAmount:1e8}),this.listings=new s.Listings,this._eventHandles=[g.stats.after("inventoryChange",this._onPlayerOwnedChange,this),this.after("quantityChange",this._validateChange,this),this.maxUnitPrice.after("amountChange",this._validateChange,this),this.maxUnitPrice.after("amountTooLowChange",(function(t){t.newVal?this.set("message",{kind:"error",msg:"transactions.error.belowminprice",msgargs:{minPrice:d(this.maxUnitPrice.get("minAmount"),!0)}}):this.set("message",!1,{msg:"transactions.error.belowminprice"})}),this)]},destructor:function(){new t.EventTarget(this._eventHandles).detach(),this._eventHandles=null},_validateChange:function(t){var e,s;t.silent||(this._checkListings(),e=this.get("totalPrice"),s=this.get("listingFee"),"buy"===this.get("buyOrSell")?e>g.stats.coins?this.set("message",{kind:"error",msg:"transactions.error.cost"}):"transactions.error.cost"===this.get("message").msg&&this.set("message",!1):s>g.stats.coins?this.set("message",{kind:"error",msg:"transactions.error.listingfee"}):"transactions.error.listingfee"===this.get("message").msg&&this.set("message",!1))},fetchItem:function(e,s){var i=e.data_id||e.dataId||e.guid;this.get("buyOrSell");return isNaN(i)?t.Promise.reject("Invalid id: "+i):"whitelisted"in e&&!e.whitelisted?(this.fire("restricted"),t.Promise.reject("Item restricted")):(s||(s={}),h.inject(i),this.set("oldMessages",[]),this.set("message",!1,{force:!0}),s.skipListings||this.listings.load({dataId:i},this._listingsFetched.bind(this,!0)),g.call("QueryItemInfo",{items:[i]}).then(this._onFetchItem.bind(this,i),(function(t){console.error(t)})))},selectListing:function(t,e){var s,i,n,a=t+"s",r=this.get("buyOrSell");if(this.set("uiLocked",!1),this.set("message",{}),this.lastListing&&this.lastListing.unitPrice===e.unitPrice){if(n=t!==r?this.listings.getQuantity(a,e.unitPrice):0,e.quantity>0)return e.quantity===e.maxQuantity||250===e.quantity?this.set("quantity",n+1,{silent:!0}):this.set("quantity",n+Math.min(250,e.maxQuantity),{silent:!0}),s=this.listings.getListings(),i="buy"===r?s[0].unitPrice:s[s.length-1].unitPrice,this.maxUnitPrice.set("amount",i),void this._checkListings();this.set("quantity",1,{silent:!0})}t!==r?(this.maxUnitPrice.set("amount",e.unitPrice,{silent:!0}),this.set("quantity",this.listings.getQuantity(a,e.unitPrice)+1,{silent:!0})):this.maxUnitPrice.set("amount",e.unitPrice,{silent:!0}),this.lastListing=e,this._checkListings()},dismissMessage:function(){var t=this.get("message");this.set("message",!1,{force:!0}),t.callback&&t.callback()},execute:function(){var t=this.get("buyOrSell"),s=this.get("item"),i=this.maxUnitPrice.get("amount");return this.get("quantity")<1?this.set("message",{kind:"error",heading:"transactions.headings.error",msg:"transactions.error.quantity.notzero"}):i<1?this.set("message",{kind:"error",heading:"transactions.headings.error",msg:"transactions.error.price.notzero"}):(this.set("uiLocked",!0),"buy"===t?this._executeBuy():(s=e.itemByDataId(s.dataId))?this.get("listingFee")>g.stats.coins?this.set("message",{kind:"error",heading:"transactions.headings.error",msg:"transactions.error.listingfee",callback:this.set.bind(this,"uiLocked",!1),duration:1/0}):this._executeSell():this.set("message",{kind:"error",heading:"transactions.headings.error",msg:"transactions.error.cantsellnothing",callback:this.fire.bind(this,"close"),duration:1/0}))},_executeSell:function(){var s=this.get("item"),i=t.bind(this._onSellResults,this),n=t.bind(this._onError,this);return(s=e.itemByDataId(s.dataId))?this.get("listingFee")>g.stats.coins?this.set("message",{kind:"error",heading:"transactions.headings.error",msg:"transactions.error.listingfee",callback:this.set.bind(this,"uiLocked",!1),duration:1/0}):(this.get("instant")&&this.maxUnitPrice.set("amount",this.listings.get("buys")[0].unitPrice),void g.call("SellItem",{id:parseInt(s.itemId,10),price:this.maxUnitPrice.get("amount"),count:this.get("quantity")}).then(i,n)):this.set("message",{kind:"error",heading:"transactions.headings.error",msg:"transactions.error.cantsellnothing",callback:this.fire.bind(this,"close"),duration:1/0})},_onSellResults:function(e){var s=t.bind(this._onSell,this),i=t.bind(this._onError,this);a.request({protocol:"Game.gw2.Trade",command:"GetSaleStatus",headers:{m:g.stats.sessionId},body:{SequenceId:e.sequenceId}}).then(s,i)},_onSell:function(t){var e,s,i,n=0,a=0,r={kind:"success",heading:"transactions.headings.success",duration:1/0,callback:this.set.bind(this,"uiLocked",!1)};for(e=0;e<t.txn_histories.length;e++)s=t.txn_histories[e],n+=i=parseInt(s.quantity,10)||0,a+=i*(parseInt(s.unit_price,10)||0);this.get("isAsk")?t.sale_listing&&t.sale_listing.unit_price?(r.heading="transactions.headings.partial",r.msg="transactions.responses.sell.instant.partial",r.kind="warning",r.msgargs={soldCount:n,soldPrice:d(a),listedPrice:d(t.sale_listing.unit_price,!0),listedCount:parseInt(t.sale_listing.quantity,10)}):(r.msg="transactions.responses.sell.instant.success",r.msgargs={count:n}):(r.msg="transactions.responses.sell.order.success",r.msgargs={count:this.get("quantity")}),0===this.get("playerOwned")&&(r.classes="no-ok-button"),u({action:"sell",itemDataId:this.get("item").dataId,sellCount:n,sellPrice:a}),this.set("message",r),this.listings.load(this._listingsFetched.bind(this))},_executeBuy:function(){var t=this.get("item"),e={offers:[]};if(this.get("isAsk")||(e.CustomOffer="whole twelve bananas"),this.get("totalPrice")>g.stats.coins)return this.set("message",{kind:"error",heading:"transactions.headings.error",msg:"transactions.error.cost",callback:this.set.bind(this,"uiLocked",!1),duration:1/0});e.offers=this.listings.getListings().map((function(t){return{UnitPrice:t.unitPrice,Quantity:t.quantity}})),a.request({protocol:"Game.gw2.Trade",command:"Buy",body:e,headers:{t:"$"+t.dataId}}).then(this._onBuy.bind(this),this._onError.bind(this))},_onBuy:function(t){var e=this.get("isAsk"),s=this.get("quantity"),i={kind:"success",heading:"transactions.headings.success",duration:1/0,callback:this.set.bind(this,"uiLocked",!1)},n={};e?(n=t.matches.reduce((function(t,e){var s=parseInt(e.quantity,10);return{quantity:t.quantity+s,cost:t.cost+parseInt(e.unit_price,10)*s}}),{quantity:0,cost:0})).quantity!==s?i={kind:"warning",heading:"transactions.headings.partial",msg:"transactions.responses.buy.instant.partial",msgargs:{wanted:s,count:n.quantity,cost:d(n.cost,!0)},duration:1/0,callback:this.set.bind(this,"uiLocked",!1)}:(i.msg="transactions.responses.buy.instant.success",i.msgargs={bought:s}):(i.msg="transactions.responses.buy.order.success",i.msgargs={count:s}),this.set("message",i),u({action:"purchase",itemDataId:this.get("item").dataId,purchaseCount:n.quantity||s,purchasePrice:n.cost||t.orders.reduce((function(t,e){return t+=parseInt(e.unit_price,10)}),0)}),this.listings.load(this._listingsFetched.bind(this))},_onError:function(t){var e=this.get("buyOrSell"),s={kind:"error",heading:"transactions.headings.error",msg:"transactions.error.generic",callback:this.set.bind(this,"uiLocked",!1),duration:1/0};if("spamming"===t.response)s.msg="transactions.error.ratelimit";else if("too_many_listings"===t.response)s.msg="transactions.error.toomanylistings";else{if("buy"===e&&!this.get("instant")&&t.body&&4===t.body.code)return this._onBuy();t.code&&(l[t.code]?s.msg=l[t.code]:a.netError(t))}return this.set("message",s)},_withinRange:function(t,e,s){return t?e<=s:e>=s},_checkListings:function(){var t,s,i=this.get("buyOrSell"),n="buy"===i?"sells":"buys",a=this.get("quantity"),r=0,o=this.maxUnitPrice.get("amount"),u="buy"===i,h=0;if(u||(h=e.itemCountByDataId(this.get("item").dataId)),this.listings.resetSelection(),(t=this.listings.get(n)).length&&this._withinRange(u,t[r].unitPrice,o)){if(u){for(;a>0&&r<t.length;)s=t[r],r++,s.quantity=Math.min(s.maxQuantity,a),a-=s.quantity,o=u?Math.max(o,s.unitPrice):Math.min(o,s.unitPrice);this.set("maxQuantity",this.listings.count(n),{silent:!0})}else t[r].quantity=Math.min(t[r].maxQuantity,a),this.set("maxQuantity",Math.min(h,t[r].maxQuantity),{silent:!0});this.set("instant",!0),this.maxUnitPrice.set("amount",o,{silent:!0})}else this.set("instant",!1),u?this.set("maxQuantity",250,{silent:!0}):this.set("maxQuantity",Math.min(250,h),{silent:!0}),this.listings.matchMake(i+"s",o,a);this.get("instant")?this.set("message",!1,{msg:"transactions.warning."+i+".order"}):this.set("message",{kind:"warning",msg:"transactions.warning."+i+".order"})},_listingsFetched:function(t){var e="buy"===this.get("buyOrSell")?"sells":"buys",s=this.listings.get(e);t&&(s.length||(s=this.listings.get(this.get("buyOrSell")+"s")).length)&&(this.maxUnitPrice.set("amount",s[0].unitPrice),this.lastListing=s[0]),this._checkListings(),this.fire("listingsUpdated")},_onPlayerOwnedChange:function(){var t,s=this.get("item"),i=this.get("maxQuantity");s&&(t=e.itemCountByDataId(this.get("item").dataId),"sell"===this.get("buyOrSell")&&(i=Math.min(t,250)),this.setAttrs({playerOwned:t,maxQuantity:i}),m.redraw())},_onFetchItem:function(t,s){var n,r,o=this,u=s[t],h=this.get("buyOrSell"),g=250;if(u){if(u.vendor=u.vendor||0,u.rarityAttr=i.reverse("Rarity",u.rarity),"ENCRYPTED_STRING"===u.name||!u.name)return this.setAttrs({uiLocked:!0,itemLoaded:!1}),c.load({type_id:u.itemType,data_id:u.dataId}).then((function(e){o.fetchItem(t,{skipListings:!0})}),(function(t){a.netError(t)}));this.setAttrs({item:u,itemLoaded:!0,uiLocked:!1}),n=e.itemCountByDataId(u.dataId),"sell"===h&&(g=Math.min(n,g)),r=Math.max(u.vendor+2,Math.ceil(u.vendor/.85)),this.maxUnitPrice.set("minAmount",r),this.maxUnitPrice.set("amount",r),this.setAttrs({playerOwned:n,maxQuantity:g},{silent:!0}),"buy"===h?this.set("quantity",1,{silent:!0}):this.set("quantity",Math.min(250,n),{silent:!0})}}},{ATTRS:{item:{value:null},buyOrSell:{value:"buy",validator:function(t){return"buy"===t||"sell"===t}},profit:{getter:function(){var t=this.get("totalPrice")-this.get("fees");return r.Coins.toObject(t)}},oldMessages:{value:[]},message:{value:!1,setter:function(e,s,i){var n=this.get("message"),a=this.get("oldMessages");if(e&&e.heading===n.heading&&e.msg===n.msg)return t.AttributeCore.INVALID_VALUE;if(i.msg&&(a=a.filter((function(t){return t.msg!==i.msg})),this.set("oldMessages",a)),!e&&n&&i.msg&&i.msg!==n.msg&&!i.force)return t.AttributeCore.INVALID_VALUE;if(!e&&a.length>0)return a.pop();if(this.timeout)clearTimeout(this.timeout),this.timeout=null;else if(n&&!n.timeout&&"error"===n.kind&&e)a.push(n),this.set("oldMessages",a);else if(n&&n.heading&&!e.heading&&!i.force)return a.push(e),this.set("oldMessages",a),t.AttributeCore.INVALID_VALUE;return e.duration&&e.duration!==1/0&&(this.timeout=setTimeout(function(){e.active="",e.death=!0,e.duration=null,this.set("message",e),m.redraw(),this.timeout=setTimeout(function(){var t=0!==a.length&&a.pop();this.set("message",t),this.timeout=null}.bind(this),1e3)}.bind(this),e.duration)),e}},quantity:{value:1,validator:t.Lang.isNumber,setter:function(t){var e=this.get("maxQuantity"),s=this.get("buyOrSell");return t>e?(this.set("quantityTooLow",!1),this.set("message",{kind:"error",duration:2e3,msg:this.get("instant")?"transactions.error."+s+".notenoughavail":"buy"!==s&&t<=250?"transactions.error.donthaveenough":"transactions.warning."+s+".limit250"}),e):(t<1?(this.set("quantityTooLow",!0),t<0&&(t=0)):this.set("quantityTooLow",!1),t)}},maxAvailable:{getter:function(){var t=this.get("buyOrSell"),s=this.get("item");return"buy"!==t&&s?e.itemCountByDataId(s.dataId):this.get("maxQuantity")}},maxQuantity:{value:250,validator:t.Lang.isNumber,setter:function(t){return t=Math.max(0,Math.min(250,t)),this.get("quantity")>t&&this.set("quantity",t),t}},instant:{value:!1},playerOwned:{value:0,validator:t.Lang.isNumber},totalPrice:{getter:function(){return this.get("instant")?this.listings.get("price"):Math.max(this.get("quantity"),1)*this.maxUnitPrice.get("amount")}},fees:{getter:function(){return this.get("listingFee")+this.get("exchangeFee")}},listingFee:{getter:function(){return Math.max(1,Math.round(.05*this.get("totalPrice")))},setter:function(){return Attr.INVALID_VALUE}},exchangeFee:{getter:function(){return Math.max(1,Math.round(.1*this.get("totalPrice")))},setter:function(){return Attr.INVALID_VALUE}},isBuy:{getter:function(){return"buy"===this.get("buyOrSell")}},isAsk:{getter:function(){return this.listings.hasQuantity("buys")!==this.get("isBuy")}},canAfford:{getter:function(){return"buy"===this.get("buyOrSell")?this.get("totalPrice")<=g.stats.coins:this.get("listingFee")<=g.stats.coins}},quantityTooLow:{setter:function(t){t?this.set("message",{kind:"error",msg:"transactions.error.quantity.notzero"}):this.set("message",!1,{msg:"transactions.error.quantity.notzero"})}},canExecute:{getter:function(){return this.get("canAfford")&&!this.listings.get("loading")&&!this.maxUnitPrice.get("amountTooLow")&&!this.get("quantityTooLow")}},executeRestricted:{getter:function(){return!GW2.config.features[`${this.get("buyOrSell")}-${o.status}`]}}}})}),"@VERSION@",{requires:["base-build","model","gw2-enums","sts-request","util-coins","element-coins","account-status","model-coins","model-listings","extension-last-viewed","util-items","util-log"]});
YUI.add("view-order",(function(e){"use strict";var t=e.namespace("GW2.Components"),s=e.namespace("GW2.Models"),i=e.namespace("Elements"),n=e.namespace("Util").optional,r=e.namespace("GW2.Util").restricted,a=e.namespace("GW2.Util").log,o=window.tp_strings,c=m.redraw.bind(m,!1),l={warning:"https://2tradingpost.staticwars.com/sections/order/images/smoke-yellow.8a3c3d86.svg",error:"https://2tradingpost.staticwars.com/sections/order/images/smoke-red.183d4d6.svg",success:"https://2tradingpost.staticwars.com/sections/order/images/smoke-green.cf711d1.svg"},d=["https://2tradingpost.staticwars.com/sections/order/images/tall-bg-success.9d97ca9a.svg","https://2tradingpost.staticwars.com/sections/order/images/tall-bg-warning.1ec4e000.svg","https://2tradingpost.staticwars.com/sections/order/images/tall-bg-error.8cbbe788.svg"],u="home",g=new s.OrderState,p=!1;function h(){e.fire("order:closed"),window.state.setSection(u,!window.state.refreshOnDialogClose()),window.state.refreshOnDialogClose(!1),m.redraw()}function b(t){return e.Object.getValue(o,t.split("."))}t.OrderMithril={showDialog:function(e,t){window.native.call("HideTextTooltip"),window.native.call("HideItemTooltip"),u=window.state.section().name,window.state.setSection("order"),g.set("buyOrSell",e),g.fetchItem(t).then(c,h),a({clickedItem:t.guid})},controller:function(){var t=this,s={gold:!1,copper:!1,silver:!1};g.on({listingsUpdated:c,close:h,restricted:r,uiLockedChange:c,messageChange:function(t){var s=t.newVal;s&&(s.msg||s.heading)&&(s.text=b(s.msg)||s.msg,e.Lang.isObject(s.msgargs)&&(s.text=e.Lang.sub(s.text,s.msgargs)),s.heading&&(s.tall=!0,s.heading=b(s.heading)||s.heading),s.background=l[s.kind],s.active=s.death?"":"active",s.msg!==(t.prevVal&&t.prevVal.msg)&&setTimeout(m.redraw,0))}}),m.redraw.strategy("diff"),this.reducer=function(e,t){var s=e.split("."),i=s.pop(),n=s.reduce((function(e,t){return e?e[t]:e}),this);return void 0!==t?n.set(i,t):n.get(i)},this.blankInput=function(e,s){var i;s.target.validity.valid?(i=""===s.target.value?0:parseInt(s.target.value,10),t.set(e,i)):s.target.value=t.get(e)},this.order=g,this.unitprice=g.maxUnitPrice,this.listings=g.listings,this.execute=function(){g.execute()},this.item=function(e){var t=this.order.get("item");return t?t[e]:null},this.get=function(e){return this.reducer(e)},this.set=function(e,t){return this.reducer(e,t)},this.mod=function(e,t){this.set(e,this.get(e)+t)},this.dismissMessage=function(){g.dismissMessage()},this.viewUpDown=function(e){return m(".updown",m("button.up",{onclick:this.mod.bind(this,e,1)}),m("button.down",{onclick:this.mod.bind(this,e,-1)}))},this.viewMouseWheelGroup=function(e,...s){return m(".mouseWheelGroup",{onmousewheel:function(s){s.preventDefault(),t.mod(e,s.wheelDeltaY>0?1:-1)}},s)},this.viewCurrency=function(e){var i=e[0],n=e[1],r="unitprice."+i;return(n=n||{}).type="number",n.min="-1",n.step="1",n.value=0!==this.get(r)||s[i]?this.get(r):"0",n.oninput=function(e){e.target.validity.valid?(s[i]=""===e.target.value,t.set(r,e.target.value)):e.target.value=t.get(r)},this.viewMouseWheelGroup(r,m("input."+i,n),this.viewUpDown(r),m("i.coin."+i))},this.viewGold=function(){return[["gold",{tabindex:2,max:1e4}],["silver",{tabindex:3,max:100}],["copper",{tabindex:4,max:100}]].map(this.viewCurrency.bind(this)).reduce((function(e,t){return e.concat(t)}),[m("label",n("buy"===this.get("order.buyOrSell"),o.buy.max,o.sell.min))])},this.profit=function(){var t=this.get("order.profit");if("sell"===this.get("order.buyOrSell"))return e.Lang.sub(o.sell.profit,{gold:t.gold,silver:t.silver,copper:t.copper})},this.tooltip=function(e,t){return t&&(e.attrs.onmouseover=function(){window.native.call("ShowTextTooltip",t),m.redraw.strategy("none")},e.attrs.onmouseout=function(){window.native.call("HideTextTooltip"),m.redraw.strategy("none")}),e},this.selectListing=function(e,t){g.selectListing(e,t)},this.viewMessages=function(){var e,t,s=this.get("order.message");return s&&s.text?s.tall?(e=[],s.classes=s.classes||"none","no-ok-button"!==s.classes&&e.push(m("button.btn.dismiss",{onclick:this.dismissMessage},o.transactions.okay)),e.push(m("button.btn.closer",{onclick:h},o.transactions.close)),t=[m(".message-text",m("h1",s.heading)),m(".message-text",{class:s.kind},m.trust(s.text))],s.background&&t.push(m(".message-background-clip",{class:s.kind},m("img.message-background",{src:s.background}))),m(".message.tall",{class:[s.kind,s.active,s.classes].join(" "),key:s.text},t.concat(e))):this.get("order.uiLocked")?m(".message"):(t=[m("span.message-text",{class:s.kind},m("i.icon.icon-"+(s.kind||"warning")),m.trust(s.text))],s.background&&t.push(m(".message-background-clip",{class:s.kind},m("img.message-background",{src:s.background}))),m(".message",{class:[s.active,s.kind].join(" "),key:s.text},t)):m(".message")},this.prefetch=function(){return d.map((function(e){return m("link",{rel:"prefetch",href:e})}))},this.viewListings=function(){var s=this.get("order.buyOrSell");return[m(".loading",m(".spinner")),["buy","sell"].map((function(e){var t={header:"transactions.listings."+e+".heading",number:"transactions.listings."+e+".quantity",listText:"transactions.listings."+e+".field",noneleftText:"transactions.listings."+e+".noneleft",selectedText:"transactions.listings."+s+("buy"===e&&s?".selected":".instant"),cssClass:"buy"===e?"bids":"asks",items:g.listings.get(e+"s")||[],type:e};return s===e&&(t.noneLeftText2="transactions.listings."+s+".noneleft2"),t})).map((function(r){return m(".listing.vbox",{class:[r.cssClass,s].join(" ")},m("h2",b(r.header)),m(".hbox.titles",m(".spacer",b(r.number)),m("div",o.transactions.headings.price)),m(".items.spacer",r.items.map((function(a,c){return t.tooltip(m(".hbox.row",{class:n(c%2,"odd"),key:a.unitPrice,"data-selected":a.quantity>0?n(r.type===s,"warning")+n(a.quantity===a.maxQuantity,"all","some"):"none",onclick:t.selectListing.bind(t,r.type,a)},m(".check"),m(".spacer",m("span.when-selected",m.trust(e.Lang.sub(b(r.selectedText),{count:"<span class='quantity'>"+a.maxQuantity+"</span>",selected:"<span class='selected'>"+a.quantity+"</span>"}))),m("span.when-not-selected",m.trust(e.Lang.sub(b(r.listText),{count:"<span class='quantity'>"+a.maxQuantity+"</span>"})))),i.coins(a.unitPrice,{hide:!0})),o.transactions.tooltips["match"+r.type])}))))}))]}},view:function(t){if(!p)return p=!0,m(".order");if("order"!==window.state.section().name)return{subtree:"retain"};const s=t.get("order.executeRestricted");return m(".order",{class:"active",onclick:function(e){e.target.classList.contains("prompt-overlay")&&h()}},e.GW2.prompt([t.prefetch(),m(".topButtons",m("button.closer.btn",{onclick:h})),n(t.get("order.itemLoaded"),m(".header",i.item({guid:t.item("dataId")}),m(".names",m("h1.rarity",{class:t.item("rarityAttr")},t.item("name")),m("h4",o.items.headings.vendor,i.coins(t.item("vendor"),{id:"vendorPrice",hide:!0})))),m(".header",m(".spinner"))),m(".commerce",m(".ordercontrols",m(".fieldset",m("label",{for:"quantity"},o.transactions.quantity),t.viewMouseWheelGroup("order.quantity",m("input.quantity",{type:"number",value:t.get("order.quantity"),tabindex:1,min:0,max:t.get("order.maxQuantity"),oninput:t.blankInput.bind(t,"order.quantity")}),t.viewUpDown("order.quantity"),m("input",{type:"range",min:1,max:t.get("order.maxQuantity"),step:1,value:t.get("order.quantity"),oninput:m.withAttr("value",(function(e){var s;(s=t.set.bind(t,"order.quantity"),function(e){s(parseInt(e,10))})(e)}))}),n("sell"===t.get("order.buyOrSell"),m("span.temp",m("span",t.get("order.quantity")),"/",m("span",t.get("order.maxAvailable")))))),m(".fieldset",t.viewGold()),m(".fieldset.dark",m("label",{for:"totalPrice",class:n(!t.get("order.canAfford"),"unaffordable")},o.buy.total),t.tooltip(i.coins(t.get("order.totalPrice"),{id:"#totalPrice",class:n("sell"===t.get("order.buyOrSell"),"sell-total")}),t.profit()),n("buy"!==t.get("order.buyOrSell"),m(".fees",t.tooltip(m(".listing-fee",o.sell.fee.listing,i.coins(t.get("order.listingFee"),{hide:!0})),o.transactions.tooltips.listingfee),t.tooltip(m(".exchange-fee",o.sell.fee.exchange,i.coins(t.get("order.exchangeFee"),{hide:!0})),o.transactions.tooltips.exchangefee)))),m(".buttons",m("button.btn#executeButton",{"data-disabled":s||!t.get("order.canExecute"),onclick(e){!s&&t.get("order.canExecute")&&t.execute()},onmouseenter(e){var t;s&&(t=o.common.disabled.free,window.native.call("ShowTextTooltip",t))},onmouseleave(e){window.native.call("HideTextTooltip")}},o[t.get("order.buyOrSell")][t.get("order.instant")?"instantly":"order"]),m("button.btn.closer#cancelButton",{onclick:h},o.transactions.cancel))),m(".messages",t.viewMessages())),m(".listings.hbox",{class:n(!t.get("listings.loading"),"active")},t.viewListings())],[t.get("order.buyOrSell"),n(t.get("order.uiLocked"),"locked")].join(" ")))}}}),"@VERSION@",{requires:["base-build","view","node","prompt","sts-request","util-coins","util-optional","util-restricted","model-orderstate","element-item","element-coins","css-order","css-spinner"]});
YUI.add("number-floater-plugin",(function(t){"use strict";var e,n=t.Lang;e=t.Base.create("number-floater-plugin",t.Plugin.Base,[],{initializer:function(){var s=this,a=s.getAttrs(),i=a.host;s._transitions={start:{opacity:1,duration:.1,easing:a.easing,on:{start:function(){this.replaceClass("hide","transitioning")}}},up:{opacity:0,duration:a.duration,easing:a.easing,transform:"translateY("+a.end+")",on:{end:function(){this.removeClass("transitioning")}}}},s._style=n.sub(e.TEMPLATES.style,a),s._node=t.Node.create(n.sub(e.TEMPLATES.floater,t.merge(a,{style:s._style}))),i.appendChild(s._node),i.setStyle("position","relative")},destructor:function(){delete this._node,delete this._transitions},show:function(t,e,n){var s,a,i=this,o=i._transitions,r=i._node,l=!0;s=parseInt(t,10),isNaN(s)&&(l=!1,s=t),a=n||l&&s<=0?"down":"up",e&&l&&r.hasClass("transitioning")&&(s+=parseInt(r.getContent(),10)||0),r.setAttribute("style",i._style).replaceClass("(up|down)",a).setContent(l?Math.abs(s):s).transition(o.start,(function(){r.transition(o.up)}))}},{NS:"floater",ATTRS:{start:{value:0},end:{value:"-10px"},duration:{value:2},easing:{value:"ease-out"}},TEMPLATES:{floater:"<span class='hide floater' style='{style}'></span>",style:"position: absolute; opacity : 0; transform: translateY({start});"}}),t.namespace("GW2.Plugins").NumberFloaterPlugin=e}),"@VERSION@",{requires:["plugin","base","node","transition"]});
YUI.add("component-balance",(function(n){"use strict";var e=window.native,a=n.namespace("Elements"),o=window.tp_strings,c=n.namespace("GW2.Plugins").NumberFloaterPlugin,t={start:"-15px",end:"-30px",duration:2,easing:"ease-out"};n.namespace("GW2.Components").Balance={controller:function(){e.stats.on("coinsChange",(function(e){var o,c=e.newVal-e.prevVal;c&&(o=document.createElement("span"),m.render(o,a.coins(Math.abs(c),{hide:!0})),n.one(document.querySelector(".balancebg .coins-floater")).floater.show(o,null,c<0),m.redraw())}))},view:function(){return m(".balance",m(".balancebg",m("span.coins-floater",{config:function(e,a){a||n.one(e).plug(c,t)}}),m("span.serif.balance-coins",a.coins(window.native.stats.coins||0)),m(".getmogold",m("a",{onclick:function(){e.call("ChangeTab","Exchange")}},o.balance.moregold))))}}}),"@VERSION@",{requires:["css-balance","element-coins","number-floater-plugin"]});
YUI.add("component-filters",(function(e){"use strict";var t,n=e.namespace("GW2.Components"),a=e.namespace("GW2").Enums,l=e.namespace("GW2.FilterCategories"),i=(e.namespace("GW2.Util"),window.tp_strings),o=e.namespace("Util").optional,s={opened:m.prop(!1),openedSelect:m.prop(!1)},r=e.namespace("GW2");function c(e,t){var n=parseInt(void 0!==t?t:e.value,10),a=parseInt(e.getAttribute("min"),10),l=parseInt(e.getAttribute("max"),10);return isNaN(n)?e.value=a||0:(e.value=Math.max(a,Math.min(l,n)),e.value)}function u(e,t){var n=window.state.section().params(),a=t?n[e].value:n[e];return{value:a||0,onmousewheel:function(n){var l=n.wheelDelta>1?1:-1;n.preventDefault(),c(n.currentTarget,parseInt(a,10)+l),window.state.setFilter(e,n.currentTarget.value,t)},oninput:function(n){c(n.currentTarget),window.state.setFilter(e,n.currentTarget.value,t)}}}function d(e,t,n){var a=window.state.section().params()[e];a===t||a&&a.selected&&a.selected===t.selected||t.selected&&-1!==function(){var e=window.state.section().params();return["armorstats1","armorstats2","armorstats3","weaponstats1","weaponstats2","weaponstats3"].map((function(t){return e[t]&&e[t].selected}))}().indexOf(t.selected)?n.stopPropagation():(s.openedSelect(!1),""!==t?window.state.setFilter(e,t):window.state.removeFilter(e))}function p(e,n){function a(){t&&(clearInterval(t),t=null)}return{onmousedown:function(a){var l=a.target.classList.contains("up")?1:-1,i=a.currentTarget.previousSibling;function o(){var t=window.state.section().params();c(i,parseInt(n?t[e].value:t[e],10)+l),window.state.setFilter(e,i.value,n)}o(),t=setInterval(o,200)},onmouseup:a,onmouseout:a}}n.Filters={controller:function(){return{powerMode:function(e){var t=e.newVal||e.target.value,n=window.state.section();if("I am Evon Gnashblade"===t)return window.state.powerMode(!window.state.powerMode()),void window.state.removeFilter("text");t?("transactions"!==n.name&&(n.sortField(!1),n.sortDesc(!1)),window.state.setFilter("text",t)):window.state.removeFilter("text")},matchMyLevel:function(){window.state.setFilter("levelMin",Math.max(0,window.native.stats.earnedLevel-5)),window.state.setFilter("levelMax",Math.min(80,window.native.stats.earnedLevel+5))}}},view:function(t){var n,c,w,v=window.state.section();return"order"===v.name?{subtree:"retain"}:(n=v.params(),c=(c=l[v.name]||l[n.category||null]).filter((function(e){return"text"!==e})),m(".search-ui.filters",{class:"",onclick:function(e){e.target.classList.contains("selectmenu")||e.target.classList.contains("selectbox")||s.openedSelect(!1)},config:function(t,n){n||e.one(t).on({clickoutside:function(){s.opened(!1),s.openedSelect(!1),m.redraw()}})}},m(".filter-container",{class:o(s.opened(),"active")},m("input.search-text[type=text][maxlength=30]",{config:function(n,a){a||"zh"!==window.native.stats.language||e.Node(arguments[0]).on("valuechange",t.powerMode)},value:n.text||"",oninput:t.powerMode,placeholder:i.filters.text.label,disabled:w}),m("button.advanced",{onclick:function(){s.opened(!s.opened()),s.openedSelect(!1)}}),m(".filter-list.vbox",c.map((function(l){var c=n[l],w=c?c.selected||c:"all";return m(".search-filter.hbox",{id:"filter"+(("available"===l||"locked"===l)&&"checkbox")||l,class:o(l.active,"active")},o("level"===l,m(".inputs.spacer",m(".hbox.spacer",m(".vbox.grow",m("label[for=levelMin]",i.filters.level.label+":"),m(".hbox",m("input[type=number][max=80][min=0]",u("levelMin")),m(".updown",p("levelMin"),m("button.up"),m("button.down")),m.trust("-&nbsp;"),m("input[type=number][max=80][min=0]",u("levelMax")),m(".updown",p("levelMax"),m("button.up"),m("button.down")),m(".spacer"),m("a.matchMyLevel",{onclick:t.matchMyLevel},i.filters.match.level)))))),o("available"===l,[m(".inputs",m("input.checkbox.available[type=checkbox][id=available]",{checked:Boolean(c),onchange:function(e){e.currentTarget.checked?window.state.setFilter("available",!0):window.state.removeFilter("available")}}),m("label[for=available]",i.filters.available.label))]),o("locked"===l,[m(".inputs",m("input.checkbox.locked[type=checkbox][id=locked]",{checked:Boolean(c),onchange:function(e){e.currentTarget.checked?window.state.setFilter("locked",!0):window.state.removeFilter("locked")}}),m("label[for=locked]",i.filters.locked.label))]),"profession"===l||"rarity"===l?m(".inputs",m(".selectbox",{disabled:!w,class:l+" "+w,onclick:function(){s.openedSelect(!s.openedSelect()&&l)}},i.filters[l][w]),m(".selectmenu",{class:o(l===s.openedSelect(),"active")},m("",{onclick:d.bind(null,l,"")},i.filters[l].all),Object.keys(a["rarity"===l?"Rarity":"Profession"]).map((function(e){return m("",{class:l+" "+e,onclick:d.bind(null,l,e)},i.filters[l][e])})))):"","discipline"===l||0===l.indexOf("weaponstats")||0===l.indexOf("armorstats")?m(".inputs",m(".hbox",m("",m(".selectbox.attribute",{onclick:function(){s.openedSelect(!s.openedSelect()&&l)}},i.filters[c?w:l].label),m(".selectmenu",{class:o(l===s.openedSelect(),"active")},m(".attribute",{onclick:d.bind(null,l,"")},i.filters[l].label),r.FilterOptions[l].map((function(e){return m(".attribute",{onclick:d.bind(null,l,{selected:e,value:0})},i.filters[e].label)})))),m("input.jointSelector[type=number][min=0]",e.merge(u(l,c&&w),{disabled:Boolean(!c),class:l,max:"discipline"===l?500:9999})),m(".updown",p(l,w),m("button.up"),m("button.down")))):null,o("bagsize"===l,m(".inputs.spacer",m(".hbox",m("label",{for:l},i.filters[l].label),m("input[type=number][min=0][max=20]",e.merge(u(l),{id:l})),m(".updown",p(l),m("button.up"),m("button.down"))))))})),m("button.btn.resetFilters",{disabled:!window.state.canReset(),onclick:window.state.resetFilters},i.filters.reset)))))}}}),"@VERSION@",{requires:["event-outside","gw2-enums","filter-types","util-optional","css-filters"]});
YUI.add("component-delivery-box",(function(e){"use strict";var t=e.namespace("GW2.Components"),n=e.namespace("Elements"),o=e.namespace("Util").optional,a=window.tp_strings.transactions.deliveries,i=window.native,s=e.namespace("GW2.Plugins").NumberFloaterPlugin,r={start:"-15px",end:"-30px",duration:2,easing:"ease-out"};function c(t,o){var a,i,s=o.stat.replace("pickup","").toLowerCase(),r=document.querySelector(".delivery");"items"===s?(a=o.newVal.length-o.prevVal.length)&&e.one(r.querySelector(".itemsFloater")).floater.show(Math.abs(a),null,a<0):"coins"===s&&(a=o.newVal-o.prevVal)&&(i=document.createElement("span"),m.render(i,n.coins(Math.abs(a),{hide:!0})),e.one(r.querySelector(".coinsFloater")).floater.show(i,null,a<0)),t[s](o.newVal),m.redraw()}t.Delivery={controller:function(){var e=m.prop(!1),t=m.prop(!1),n=m.prop(!1),o={coins:m.prop(i.stats.pickupCoins||0),items:m.prop(i.stats.pickupItems||[])};return i.call("IsTradingPostActive").then((function(n){t(n),n&&e(!0),m.redraw()})),i.stats.on(["pickupCoinsChange","pickupItemsChange"],c.bind(null,o)),{expanded:e,active:t,pickup:o,disabledMsg:n,itemsHover:function(e){return m.redraw.strategy("none"),t()||!e.forced&&e.relatedTarget&&(e.relatedTarget===e.currentTarget||e.currentTarget.compareDocumentPosition(e.relatedTarget)&Node.DOCUMENT_POSITION_CONTAINED_BY)?null:(m.redraw.strategy("diff"),void n("mouseover"===e.type))}}},view:function(t){var c=t.pickup.items(),l=t.pickup.coins();return m(".delivery",{class:o(t.expanded(),"expanded")+" "+o(c.length||l,"hasPickup")+" "+o(t.active(),"active")+" "+o(0===window.location.pathname.indexOf("/transactions"),"transactions")},m(".hbox.hd",{onclick:function(){t.expanded(!t.expanded())}},m("h1.title",m("span.alertIcon"),a.title),m(".expander")),m(".notes",m("a[href=/transactions/history]",{config:m.route},a.items+" "),m("span.itemsFloater",{config:function(t,n){n||e.one(t).plug(s,r)}}),m("span.itemsLength",t.pickup.items().length)),m(".notes.hbox",m("a[href=/transactions/history]",{config:m.route},a.funds),m("span.coinsFloater",{config:function(t,n){n||e.one(t).plug(s,r)}}),n.coins(t.pickup.coins(),{hide:!0})),m(".expandArea",m(".items",{onmouseover:t.itemsHover,onmouseout:t.itemsHover},m(".message.vbox",{class:o(!t.active()&&!t.disabledMsg(),"show")+" "+o(!c.length,"empty")},m("p",m.trust((c.length||l?a.not.available:a.no.items).replace("{tradingIcon}",'<span class="icon"></span>')))),t.pickup.items().map((function(e){return n.item({guid:e.itemId,count:e.count})}))),m(".controls",m("button.btn",{disabled:!t.active(),onclick:function(){t.active()&&i.call("PickupAllItems")}},a.button))))}}}),"@VERSION@",{requires:["css-delivery","util-optional","element-item","element-coins","number-floater-plugin"]});
YUI.add("component-tabs",(function(e){"use strict";var n=window.tp_strings.tabs,s=[{name:"home",href:"/"},{name:"browse",href:"/browse"},{name:"sell",href:"/sell"},{name:"transactions",href:"/transactions"}];e.namespace("GW2.Components").Tabs={view:function(){return m(".tabs",s.map((function(e){return m("a.tab",{config:m.route,href:e.href,class:e.name+" "+(e.disabled?"disabled ":" ")},n[e.name])})))}}}),"@VERSION@",{requires:["css-tabs"]});
YUI.add("component-categories",(function(e){"use strict";var t=e.namespace("GW2.Components"),a=e.namespace("Util").optional,n=e.namespace("navigation"),i=e.namespace("Elements"),o=window.tp_strings;t.Categories={view:function(){var e,t,s,r,c=window.state.section();return"order"===c.name?{subtree:"retain"}:(r=n[c.name]||n.browse,e=c.params(),t="home"===c.name?null:e.category,s=e.subcategory,m(".navigation.view-categories",m("ul.list",Object.keys(r).map((function(e,n){var c,l=r[e],u=t===e;return l?(c=Object.keys(l).filter((function(e){return"noSubCat"!==e})),m("li.cat",{class:a(u,"active ")+a(n%2,"odd"),onclick:function(){window.state.setCategory(u?null:e)}},m("a.target",{class:a(!l.dataId&&c.length,"arrow")},a(l.dataId,i.item({guid:l.dataId,name:l.name}),l.name||o.category[e])),a(!l.dataId&&c.length,m("ul.sub",{style:{height:u?"auto":"0px"}},c.map((function(n){return m(".cat",{class:a(s===n,"active"),onclick:function(e){e.stopImmediatePropagation(),window.state.setCategory(t,n===s?null:n)}},m("a.target",o.filters[e]?o.filters[e][n]:""))})))))):null})))))}}}),"@VERSION@",{requires:["css-categories","navigation","element-item","util-optional","util-log","node-event-simulate"]});
YUI.add("item-table-controller",(function(e){"use strict";var t=e.namespace("ItemTable"),n=e.namespace("STS");t.Controller=function(){var r,i=window.state.section;return(r={_reset:function(){r.scroll={y:0,visible:0,item:0,height:0,max:0,measured:!1},r.transitioned=!1,r.cancelling=null},_wipe:function(e){e&&e.saveScrollPosition?r.scroll.measured=!1:r._reset()},_measure:function(){var t=e.one(".views"),n=t&&t.one(".items"),o=t&&t.one(".item-row"),l=r.scroll;n&&o&&(l.item=o.get("region").height,l.height=n.get("region").height,l.visible=l.height/l.item,l.max=Math.max(l.item*i().results().length,l.height),l.measured=!0,m.redraw())},_onScroll:function(e,n){var i,o=r.prevViewport.current,l=r.scroll.visible;r.scroll.y=n.target.scrollTop,i=t.viewport(r,e).current,0!==r.scroll.y&&i<o+l&&i>o-l&&m.redraw.strategy("none")},_onCancelClick:function(e,t){t.stopPropagation(),r.cancelling=e},_onConfirmClick:function(t,o){var l;o.stopPropagation(),l={orderId:parseInt(t.listing_id,10)},i().unfiltered(i().unfiltered().filter((function(e){return e.id!==t.id}))),r.cancelling=null,t.isBuy&&(l.isBuy=""),n.request({protocol:"Game.gw2.Trade",command:"Cancel",type:"None",body:l,headers:{t:"$"+t.data_id}}).catch((function(t){n.netError(t),e.GW2.transactions.get()}))},_onMoreClick:function(t){t.preventDefault(),m.startComputation(),e.GW2.transactions.get({more:!0}).then((function(){r.scroll.max=r.scroll.item*i().results().length,m.endComputation()}))}})._reset(),e.on("items:synced",r._wipe),r}}),"@VERSION@",{requires:["sts-request"]});
YUI.add("item-table-data",(function(e){"use strict";var a=e.namespace("ItemTable"),t={headers:{},columns:{sell:["name","level","buy_price"],browse:["name","level","sell_price","favorite"],transactions:["name","isBuy","unit_price","date","cancelable"]},quantities:{sell:"count",browse:"sell_count",transactions:"quantity"},cells:{buy_price:"coins",cancelable:"cancel",date:"date",isBuy:"isbuy",name:"name",sell_price:"coins",unit_price:"coins",favorite:"favorite"}};e.Object.each(t.columns,(function(e,a){t.headers[a]=e.slice(),t.headers[a].unshift("quantity")})),a.data=t}));
YUI.add("util-relative-time",(function(e){"use strict";var t=e.namespace("GW2.Util"),a=window.tp_strings.time.fuzzy,n=6e4,i=36e5,u=864e5,r=2592e6,m=31536e6;t.relativeTime=function(t,s){var o;return s=s||new Date,(o=Math.max(0,s.getTime()-t.getTime()))<n?e.Lang.sub(a.second,{time:Math.round(o/1e3)}):o<i?e.Lang.sub(a.minute,{time:Math.round(o/n)}):o<u?e.Lang.sub(a.hour,{time:Math.round(o/i)}):o<r?e.Lang.sub(a.day,{time:Math.round(o/u)}):o<m?e.Lang.sub(a.month,{time:Math.round(o/r)}):e.Lang.sub(a.year,{time:Math.round(o/m)})}}),"@VERSION@",{requires:["base"]});
YUI.add("item-table-cells",(function(e){"use strict";var t=e.namespace("GW2.Util"),i=e.namespace("GW2.Util.items"),n=e.namespace("Elements"),a=window.native,c=window.tp_strings;function l(){m.redraw.strategy("none"),a.call("HideTextTooltip")}function o(e){m.redraw.strategy("none"),a.call("ShowTextTooltip",e.toLocaleString())}function s(t){if(m.redraw.strategy("none"),i.maxFavoritesReached()&&!t.item.favorite)return a.call("ShowTextTooltip",e.Lang.sub(c.favorites.max,{num:window.maxFavorites}));l()}e.namespace("ItemTable").cells={cancel:function(e){if(e.item.cancelable)return m(".actions",{class:e.ctrl.cancelling===e.item.id?"active":""},m("button.btn.cancel",{onclick:e.ctrl._onCancelClick.bind(e.ctrl,e.item.id)},c.transactions.cancel),m("button.btn.confirm",{onclick:e.ctrl._onConfirmClick.bind(e.ctrl,e.item)},c.transactions.confirm))},coins:function(e){return n.coins(e.item[e.col],{hide:!0})},date:function(e){return m("span",{onmouseover:o.bind(null,e.item.date),onmouseout:l},t.relativeTime(e.item.date))},name:function(e){return n.item({count:e.item.count||e.item.quantity||e.item.sell_count||0,guid:e.item.data_id,locked:!e.item.whitelisted,name:e.item.name,rarity:e.item.rarity,tooltip:!0})},isbuy:function(e){var t=e.item.section+(e.item.isBuy?"-buy":"-sell");return c.category.transaction[t]},favorite:{view:function(e,t){var n="cell-favorited",a="cell-unfavorite",c="cell-overlimit",o="cell-overlimit2";return i.maxFavoritesReached()&&e.class===c||e.class===o||(e.class=t.item.favorite?n:a),m(".cell",{class:e.class,onclick:function(){!i.maxFavoritesReached()||t.item.favorite?(e.class=e.class===n?a:n,i.editFavorite(t)):e.class===a?e.class=c:e.class=e.class===c?o:c},onmouseover:s.bind(null,t),onmouseout:l})}}}}),"@VERSION@",{requires:["util-relative-time","util-items","element-coins","element-item"]});
YUI.add("item-table-viewport",(function(e){"use strict";e.namespace("ItemTable").viewport=function(e,t){var a,i,n,m,r=e.scroll,o=r.y;return r.measured?(m=window.state.powerMode()?30:10,a=Math.floor(r.y/r.item),i=Math.max(a-m,0),n=Math.min(a+r.visible+m,t.length),o=Math.max(r.y-m*r.item,0),o=Math.abs(o-r.y%r.item),{current:a,begin:i,end:n,y:o=Math.min(o,r.max-(n-i)*r.item)}):(setTimeout(e._measure.bind(e),0),{begin:0,end:1,y:r.y})}}));
YUI.add("item-table-outer",(function(t){"use strict";var e=t.namespace("ItemTable"),s=t.namespace("Util").optional,a=e.data,i=window.tp_strings;function n(t,e){var n=window.state.section(),o="quantity"===e?a.quantities[n.name]:e,l=n.sortDesc()?"desc":"asc",r=n.sortField();return"favorite"===r&&"desc"===l&&(l=""),m(".cell",{class:["cell-"+(a.cells[e]||e),s(o===r,l)].join(" "),onclick:m.withAttr("data-sort",window.state.sort),"data-sort":o},m("a",i.items.headings[e]))}e.outer=function(e,o){var l,r=window.state.section().name,c=!window.state.synced();return m(".view.item-table",m(".spacer.vbox.cards",m(".loader",{class:s(c,"loading")},m(".spinner")),m(".item-list.vbox",m(".item-header.hbox",a.headers[r].map(n.bind(null,e))),o),m(".item-messages","transactions"===r?function(e){var a=window.state.section();if(a.loadMore())return m(".message.more",{config:function(t){t.classList.contains("active")||setTimeout((function(){t.classList.add("active")}),0)}},m(".more-total",s(window.state.canReset(),a.results().length,t.Lang.sub(i.items.total,{amount:a.results().length,total:a.totalResults()}))),m("button.messageButton.btn",{disabled:!window.state.synced(),onclick:e._onMoreClick.bind(e)},i.items.loadmore))}(e):"","browse"===r?(l=window.state.section(),m(".message.max",{class:s(500===(l.results()&&l.results().length)&&!window.state.powerMode(),"active")},i.items.maxresults)):"")))}}),"@VERSION@",{requires:["util-optional","item-table-data"]});
YUI.add("item-table-view",(function(t){"use strict";var e=t.namespace("ItemTable"),o=t.namespace("Util").optional,n=t.namespace("GW2.Components"),s=window.native,l=e.data,i=window.tp_strings,a=!1;e.view=function(t){var c,r,u,d=window.state.section().name,w="Steam"===s.stats.provider&&!s.stats.tScore;return a?-1===["browse","sell","transactions"].indexOf(d)?{subtree:"retain"}:(c=window.state.section().results(),r=e.viewport(t,c),u=window.state.synced(),!c.length&&u?e.outer(t,m(".no-items",{config:function(t){t.classList.contains("active")||setTimeout((function(){t.classList.add("active")}),0)}},i.items.noresults)):(t.prevViewport=r,e.outer(t,m(".items",{config:function(e,o){!o&&t.scroll.y>0&&0===e.scrollTop&&(e.scrollTop=t.scroll.y)},onscroll:o(c.length,t._onScroll.bind(t,c),null),class:[o(r.y>0,"scrolled"),o(r.begin>0&&r.end===c.length,"bottom"),o(window.state.powerMode(),"power")].join(" ")},m(".wrapper",{style:{height:o(t.scroll.max,t.scroll.max+"px","auto")}},m(".viewport",{style:{transform:"translateY("+r.y+"px)"}},c.slice(r.begin,r.end).map((function(a,c){return m("div.hbox",m(".item-row.hbox",{key:a.clientId,class:[o(c%2,"odd"),o(window.state.powerMode()||"sell"===d,"shown")].join(" "),style:{transitionDelay:15*(c-1)+"ms, 0, 0"},"data-quantity":a[l.quantities[d]],onmouseover:function(){w&&(m.redraw.strategy("none"),s.call("ShowTextTooltip",i.common.disabled.tScore))},onmouseout:function(){w&&(m.redraw.strategy("none"),s.call("HideTextTooltip"))},onclick:function(){w||n.OrderMithril.showDialog("sell"===d?"sell":"buy",a)},config:function(t){t.classList.contains("shown")||setTimeout((function(){t.classList.add("shown")}),0)}},l.columns[d].map((function(o){return"favorite"===o?null:m(".cell",{class:"cell-"+(l.cells[o]||o)},o in l.cells?e.cells[l.cells[o]]({item:a,col:o,ctrl:t}):a[o])}))),"browse"===d?m.component(e.cells.favorite,{item:a,ctrl:t}):null)})))))))):(a=!0,m(".items"))}}),"@VERSION@",{requires:["util-optional","util-text-keys","item-table-data","item-table-cells","item-table-viewport","item-table-outer","css-item-table","css-spinner"]});